<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<html>
  <head>
    <title>index</title>
    <script type="text/javascript" src="synthesizer.js"></script>
  </head>
  <body>
    <script type="text/javascript" charset="utf-8">
      var app = Elm.Synthesizer.fullscreen()
      var context = new AudioContext();
      var vol = context.createGain();
      vol.connect(context.destination);

      // create oscillator when first played
      var osc = context.createOscillator();

      currentPlayedOscillators = {};

      app.ports.play.subscribe(function (frequency) {
        console.log(frequency)

        osc = context.createOscillator();
        osc.frequency.value = frequency;

        vol.gain.value = 1;
        osc.connect(vol);
        osc.start();
        currentPlayedOscillators[frequency] = osc;
      });

      app.ports.stop.subscribe(function (frequency) {
        osc = currentPlayedOscillators[frequency]
        vol.gain.value = 0;
        osc.disconnect();
        osc = null;
        currentPlayedOscillators[frequency] = null;
      });
    </script>
  </body>
</html>
