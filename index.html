<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<html>
  <head>
    <title>index</title>
    <script type="text/javascript" src="synthesizer.js"></script>
  </head>
  <body>
    <script type="text/javascript" charset="utf-8">
      var app = Elm.Synthesizer.fullscreen()
      var context = new AudioContext();
      var vol = context.createGain();

      vol.gain.value = 1;
      vol.connect(context.destination);

      var currentPlayedOscillators = {};

      app.ports.play.subscribe(function (frequency) {
        console.log(frequency)

        osc = context.createOscillator();
        osc.frequency.value = frequency;

        osc.connect(vol);
        osc.start();
        currentPlayedOscillators[frequency] = osc;
        console.log('start');
        console.log(currentPlayedOscillators);
      });

      app.ports.stop.subscribe(function (frequency) {
        osc = currentPlayedOscillators[frequency]
        osc.stop();
        osc.disconnect();
        osc = null;
        delete currentPlayedOscillators[frequency];
        console.log('stop');
        console.log(currentPlayedOscillators);
      });
    </script>
  </body>
</html>
